step,step_enabled,description,category,command,regex,has_score,low_impact_result1,med_impact_result2,high_impact_result3,low_recommendation,med_recommendation,high_recommendation
1,yes,SQL Service is Running,Install,"net start | findstr /RC:""SQL Server (""",(SQL Server) \(,no,,,,,,
1,yes,SQL Server Installed,Install,"reg query ""HKLM\Software\Microsoft\Microsoft SQL Server\",InstalledInstances\s+\w+_SZ\s+(\w+\\*\w*)HKEY,no,,,,,,
1,yes,Is BYOL,Install,,,no,,,,,,
2,yes,SQLCmd Is Installed,Install,sqlcmd -?,\[-(Y) fixed length,no,,,,,,
2,yes,SQL Instance Name,Install,"sqlcmd -H localhost,1433 -I -Q ""select @@servicename;""",---\s*(\w.+)\(\d+\srows,no,,,,,,
3,yes,SQL Version String,Server,"sqlcmd -H localhost,1433 -I -Q ""select @@version;""",---\s*(\w.+)\(\d+\srows,no,,,,,,
4,yes,SQL Edition,Server,"sqlcmd -H localhost,1433 -I -Q ""select @@version;""",---\s*.+Corporation\s*(\D+)\s\(,no,,,,,,
5,yes,Version Complexity,Server,"sqlcmd -H localhost,1433 -I -Q ""select @@version;""",---\s*\w.+Server (20\d\d).+\(\d+\srows,yes,-le 2016,-le 2012,-le 2008,Use SQL Server to backup and restore to SQL target version (e.g. 2017),Use SQL Server to backup and restore to SQL target version (e.g. 2017),Use SQL Server to backup and restore to SQL target version (e.g. 2017)
6,yes,Stored User SSIS Packages,Services,"sqlcmd -H localhost,1433 -I -Q ""use msdb; select count(*) from [dbo].[sysssispackages] where ownersid <>0x01;""",---\s*(\w+)\(\d+\srows,yes,-gt 0,-ge 10,-ge 20,Develop a script to perform integration jobs,"Consider refactoring integration jobs into Cloud Functions, Cloud Run, Dataflow","Consider refactoring integration jobs into Cloud Functions, Cloud Run, Dataflow"
7,yes,SSIS Service Is Running,Services,"net start | findstr /RC:""Integration Services 1""",\s(Integration Services),yes,"-eq """"","-eq ""Integration Services""","-eq """"",,"Consider refactoring integration jobs into Cloud Functions, Cloud Run, Dataflow",
8,yes,SSAS Service Is Running,Services,"net start | findstr /RC:""Analysis Services (""",\s(Analysis Services),yes,"-eq """"","-eq ""Analysis Services""","-eq """"",,Consider pulling data into BigQuery for analytical processing,
9,yes,SSRS Service Is Running,Services,"net start | findstr /RC:""Reporting Services (""",\s(Reporting Services),yes,"-eq """"","-eq ""Reporting Services""","-eq """"",,Consider refactoring reports for a DataStudio or Looker reporting solution,
10,no,Windows SQL Logins (AD),Auth,"sqlcmd -H localhost,1433 -I -Q ""Declare @winlogins table(a char (50), b char (50), c char (50) , d char (50), e char(50)); insert into @winlogins exec master..xp_logininfo; select count(a) winlogins from @winlogins where a not like ''NT %'';"" ",---\s+(\w+)\s*\(\d+\srows,yes,-ge 10,-ge 100,-ge 500,Create SQL Logins for misc. database users,Consider participating in the Managed AD preview for Cloud SQL,Consider participating in the Managed AD preview for Cloud SQL
11,yes,SQL Server Storage Used (in TB),Storage,"sqlcmd -H localhost,1433 -I -W -Q ""select sum (convert(Decimal(18,2),(size*8/1024)))/1024/1024 TB_Storage_Used FROM sys.master_files;""",---\s*(\d*.\d+)\s*\(\d+\srows,yes,-ge 4,-ge 30,-ge 60,Consider Striim tool for data movement,Contact support for a storage increase. Consider using Striim for data movement,Consider logically splitting database workloads across multiple instances
12,yes,Always On Availability Used,HADR,"sqlcmd -H localhost,1433 -I -W -Q ""select coalesce(SERVERPROPERTY(''IsHadrEnabled'') ,0) HasAoAG;""",---\s*(\w+)\s+\(\d+\srows,yes,-eq 1,-eq 1,-eq 1,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.
13,yes,Windows Failover Cluster Used,HADR,"sqlcmd -H localhost,1433 -I  -W -Q ""select SERVERPROPERTY(''IsClustered'') [Clustered];""",---\s*(\w+)\s*\(\d+\srows,yes,-eq 1,-eq 1,-eq 1,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.,Cloud SQL offers a zonal HA option w/automic failover. Additional HA options previewing soon.
14,yes,Databases with DQS Roles,Services,"sqlcmd -H localhost,1433 -I -Q ""DECLARE @dqs TABLE(a int);insert INTO @dqs (a) EXEC sp_MSForEachdb ''use ?;SELECT count(name) FROM sys.database_principals where name like ''''dqs_%''''''; select sum(a) dqsdbs from @dqs;""",---\s*(\w+)\s*\(\d+\srows,yes,-ge 1,-ge 10,-ge 100,,,
15,yes,Databases with Log Shipping,HADR,"sqlcmd -H localhost,1433 -I -Q ""use master;DECLARE @lsdbs TABLE(a char(100),b char(100),c char(100),d char(100), e char(100), f char(100), g char(100), h char(100), i char(100), j char(100), k char(100), l char(100), m char(100), n char(100), o char(100));insert INTO @lsdbs EXEC sp_help_log_shipping_monitor ; select count(*) LogShipDBs from @lsdbs;""",---\s*(\w+)\s*\(\d+\srows,yes,-ge 1,-ge 1,-ge 1,,,
16,yes,Database Mail In Use,Feature,"sqlcmd -H localhost,1433 -I -W -Q ""SELECT value_in_use DBMailEnabled FROM  sys.configurations WHERE name = ''Database Mail XPs'';""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
17,yes,Local MSDTC Enabled,Feature,"reg query ""HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSDTC\Security"" /v NetworkDtcAccess",REG_DWORD\s+(\dx\d),yes,"-eq ""0x1""","-eq ""0x1""","-eq ""0x1""",,,
18,yes,Databases Using File Table,Feature,"sqlcmd -H localhost,1433 -I -W -Q ""SELECT count (*) FTDBs from sys.database_filestream_options where non_transacted_access_desc <> ''OFF'';""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
19,yes,Filestream Groups Used,Feature,"sqlcmd -H localhost,1433 -I -W -Q "" DECLARE @FsGrps TABLE(a char(25));insert INTO @FsGrps EXEC sp_MSForEachdb ''SELECT  type  FROM  sys.filegroups;''; select count(a) FilestreamGroups from @FsGrps where a=''FD'';""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
20,yes,Maintenance Plans Stored,Feature,"sqlcmd -H localhost,1433 -I -W -Q ""use msdb; select count(*) MaintPlans from sysmaintplan_plans;"" ",---\s*(\w+)\s*\(\d+\srows,yes,-gt 1,-gt 5,-gt 10,,,
21,yes,Get Snapshot Server CPU Load (PCT),Script Use,"typeperf -sc 1  -si 3 ""\processor(_total)\% processor time"" | findstr /E ""\""[0-9]*\.[0-9]*\"""" >>%Temp%\gtcsrt21.tmp",,no,,,,,,
21,yes,Snapshot Server CPU Load (PCT),Perf,type %Temp%\gtcsrt21.tmp,",""(\d*\.*\d+)""",no,,,,,,
22,yes,Get Snapshot Server Memory Free (MB),Script Use,"typeperf -sc 1  ""\Memory\Available MBytes""  | findstr /E ""\""[0-9]*\.[0-9]*\"""">>%Temp%\gtcsrt22.tmp",,no,,,,,,
22,yes,Snapshot Server Memory Free (MB),Perf,type %Temp%\gtcsrt22.tmp,",""(\d*\.*\d+)""",no,,,,,,
23,yes,Get Snapshot Disk Read/Sec,Script Use,"typeperf -sc 1 -si 3 ""\PhysicalDisk(_Total)\Avg. Disk sec/Read""  | findstr /E ""\""[0-9]*\.[0-9]*\"""">>%Temp%\gtcsrt23.tmp",,no,,,,,,
23,yes,Snapshot Disk Read/Sec,Perf,type %Temp%\gtcsrt23.tmp,",""(\d*\.*\d+)""",no,,,,,,
24,yes,Get Snapshot Disk Write/Sec,Script Use,"typeperf -sc 1 -si 3 ""\PhysicalDisk(_Total)\Avg. Disk sec/Write""  | findstr /E ""\""[0-9]*\.[0-9]*\"""">>%Temp%\gtcsrt24.tmp",,no,,,,,,
24,yes,Snapshot Disk Write/Sec,Perf,type %Temp%\gtcsrt24.tmp,",""(\d*\.*\d+)""",no,,,,,,
25,yes,Get Snapshot Network Bytes/Sec,Script Use,"typeperf -sc 1 -si 3 ""\Network Interface(*)\Bytes Total/sec""  | findstr /E ""\""[0-9]*\.[0-9]*\"""">>%Temp%\gtcsrt25.tmp",,no,,,,,,
25,yes,Snapshot Network Bytes/Sec,Perf,type %Temp%\gtcsrt25.tmp,",""(\d*\.*\d+)""",no,,,,,,
26,yes,Get Snapshop SQL User Connections,Script Use,"typeperf -sc 1  ""[[SQLInstance]]:General Statistics\User Connections""  | findstr /E ""\""[0-9]*\.[0-9]*\"""">>%Temp%\gtcsrt26.tmp",,no,,,,,,
26,yes,Snapshop SQL User Connections,Perf,type %Temp%\gtcsrt26.tmp,",""(\d*\.*\d+)""",no,,,,,,
27,yes,Data Collector Users,Feature,"sqlcmd -H localhost,1433 -I -Q ""DECLARE @dc TABLE(a int);insert INTO @dc (a) EXEC sp_MSForEachdb ''use ?;SELECT count(name) FROM sys.database_principals where name like ''''dc_%''''''; select sum(a) DcUsers from @dc;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 10,-gt 20,Consider integrating SQL Insights with the Cloud Operations Suite,Consider integrating SQL Insights with the Cloud Operations Suite,Consider integrating SQL Insights with the Cloud Operations Suite
28,yes,Policy Management Policies Enabled,Feature,"sqlcmd -H localhost,1433 -I -Q ""USE msdb;SELECT count(*) PoliciesEnabled FROM syspolicy_policies where is_enabled =1 ;""  ",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
29,yes,External Scripts Enabled (ML/R),Feature,"sqlcmd -H localhost,1433 -I -Q ""Declare @extscript Table (a char(50), b int, c int, d int, e int )insert  into @extscript exec sp_configure; select e ExtScriptsEnabled  from @extscript where a=''external scripts enabled''; """,---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
30,yes,Compute Nodes Used (Polybase),Feature,"sqlcmd -H localhost,1433 -I -Q ""select count (*) ComputeNodes from sys.dm_exec_compute_nodes;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
31,yes,Resource Governor Groups,Feature,"sqlcmd -H localhost,1433 -I -Q ""select count(*) ResGovGroups FROM sys.resource_governor_workload_groups;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 2,-gt 2,Use Cloud SQL Insights with Cloud Operations Suite,Use Cloud SQL Insights with Cloud Operations Suite,Use Cloud SQL Insights with Cloud Operations Suite
32,yes,SQL Server Audits,Feature,"sqlcmd -H localhost,1433 -I -Q ""select count (*) ServerAudits from sys.server_audits;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
33,yes,Server-Level Triggers,Feature,"sqlcmd -H localhost,1433 -I -Q ""select count(*) ServTriggers from sys.server_triggers;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
34,yes,Service Broker Tasks,Feature,"sqlcmd -H localhost,1433 -I -Q ""select count(*) ServBrokerTasks from sys.dm_broker_activated_tasks;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
35,yes,SQL Endpoints,Feature,"sqlcmd -H localhost,1433 -I -Q ""SELECT count (*) Endpoints FROM sys.endpoints where state =0;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 4,-gt 8,-gt 12,"Consider creating middleware applications that connect with standard connection strings using Cloud Run, Cloud Functions, App Engine","Consider creating middleware applications that connect with standard connection strings using Cloud Run, Cloud Functions, App Engine","Consider creating middleware applications that connect with standard connection strings using Cloud Run, Cloud Functions, App Engine"
36,no,DBs with CDC Enabled,Feature,"sqlcmd -H localhost,1433 -I -Q ""select count(*) DBsWithCdc from sys.databases where is_cdc_enabled=1;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
37,yes,CLR Procedures/Functions Used,Feature,"sqlcmd -H localhost,1433 -I -Q ""Declare @UserCLRObjects Table (a int);insert into @UserCLRObjects exec sp_MSforeachdb ''Select count(*) a From ?..sysobjects where ObjectProperty(id, ''''IsMSShipped'''') =0 and (xtype =''''FS'''' or type =''''FT'''' or type =''''TA'''' or type =''''PC''''); '' select SUM(a) UserCLRObjects from @UserCLRObjects; """,---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
38,yes,Linked Servers,Feature,"sqlcmd -H localhost,1433 -I -Q ""SELECT count(*) LinkedServiers FROM sys.servers WHERE is_linked = 1;""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
39,yes,External Access Assemblies,Feature,"sqlcmd -H localhost,1433 -I -Q ""select COUNT(*) ExtAccAsmblyEnabled from sys.server_permissions where permission_name = ''External access assembly'' and state=''G'';""",---\s*(\w+)\s*\(\d+\srows,yes,-gt 0,-gt 0,-gt 0,,,
